<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Forecast</title>
  <!-- Dynamic CSS loading based on environment -->
  <script>
    // Detect environment and load appropriate CSS path
    const isLiveServer = window.location.port === '5500' || window.location.hostname === '127.0.0.1';
    const cssPath = isLiveServer ? 'weather.css' : '/weather/weather.css';
    document.write('<link rel="stylesheet" href="' + cssPath + '" />');
  </script>
</head>
<body>

  <div class="main-container">
    <section class="hero-section">
      <div class="location-display">
        <div class="location-icon">üìç</div>
        <span id="displayLocation">Loading...</span>
      </div>
      <h1 class="hero-title">The only weather forecast you need</h1>
      <div class="search-container">
        <input type="text" class="search-box" placeholder="Enter Location" id="locationInput" />
        <button class="search-btn" onclick="searchWeather()">Search</button>
      </div>
    </section>

    <aside class="weather-sidebar">
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('weather')">Weather</button>
        <button class="nav-tab" onclick="showTab('forecast')">Forecast</button>
        <button class="nav-tab" onclick="showTab('alerts')">Alerts</button>
      </div>

      <!-- Weather Tab Content -->
      <div id="weatherTab" class="tab-content active">
        <div class="weather-section">
          <h2 class="section-title">Today</h2>

          <div class="current-weather">
            <div>
              <div class="temp-display">
                <span id="tempValue">--</span><span class="temp-unit">¬∞C</span>
              </div>
              <div class="temp-description" id="tempDescription">--</div>
              <div class="day-info">
                <span id="weatherDesc" class="day-name">--</span>
              </div>
            </div>
            <div class="weather-details">
              <div id="humidity">Humidity: --</div>
              <div id="realFeel">RealFeel: --</div>
              <div id="uvIndex">UV Index: --</div>
              <div id="visibility">Visibility: --</div>
            </div>
          </div>
        </div>

        <!-- Compact Activities Section - Right below main weather -->
        <div class="weather-section activities-compact">
          <h2 class="section-title">Recommended Activities</h2>
          <div class="activities-grid-compact" id="compactActivitiesGrid" style="display: none;">
            <!-- Activities will be dynamically populated here -->
          </div>
        </div>
      </div>

      <!-- Forecast Tab Content -->
      <div id="forecastTab" class="tab-content">
        <div class="weather-section">
          <h2 class="section-title">Next 10 Hours <span class="last-refresh"></span></h2>
          <div class="hourly-forecast-container">
            <!-- Hourly forecast will be dynamically populated here -->
          </div>
        </div>

        <div class="weather-section">
          <h2 class="section-title">7-Day Forecast</h2>
          <div class="daily-forecast-container">
            <!-- Forecast days will be dynamically populated here -->
          </div>
        </div>
      </div>

      <!-- Alerts Tab Content -->
      <div id="alertsTab" class="tab-content">
        <div class="weather-section">
          <h2 class="section-title">Weather Alerts</h2>
          <div class="alerts-container">
            <p class="no-alerts">No weather alerts at this time.</p>
            <!-- Weather alerts will be dynamically populated here -->
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Load weather app directly - with environment-aware path -->
  <script>
    // Use the already detected environment from CSS loading
    const weatherJsPath = (window.location.port === '5500' || window.location.hostname === '127.0.0.1') ? 'weather.js' : '/weather/weather.js';
    document.write('<script src="' + weatherJsPath + '"><\/script>');
  </script>
  
  <!-- Debug script to check if weather app loaded -->
  <script>
    setTimeout(async () => {
      console.log('üîç Checking weather app status...');
      console.log('Weather controller available:', typeof window.weatherController !== 'undefined');
      console.log('Search function available:', typeof window.searchWeather !== 'undefined');
      
      // Check environment
      const isLiveServer = window.location.port === '5500' || window.location.hostname === '127.0.0.1';
      console.log('üåê Environment:', isLiveServer ? 'Live Server (5500)' : 'Express Server (3000)');
      
      if (isLiveServer) {
        // Test if backend server is running
        try {
          console.log('üîç Testing backend server connection...');
          const response = await fetch('http://localhost:3000/api/weather?location=Singapore');
          if (response.ok) {
            console.log('‚úÖ Backend server is running on localhost:3000');
          } else {
            console.error('‚ùå Backend server responded with error:', response.status);
          }
        } catch (error) {
          console.error('‚ùå Backend server is not running or not accessible:', error.message);
          console.warn('üí° Please start your backend server: node app.js');
        }
      }
      
      // Try to initialize weather automatically
      if (typeof window.searchWeather === 'function') {
        console.log('üå§Ô∏è Auto-loading Singapore weather...');
        window.searchWeather('Singapore');
      } else {
        console.error('‚ùå searchWeather function not available');
      }
    }, 3000);

    // Tab switching functionality
    window.showTab = function(tabName) {
      // Hide all tab contents
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Remove active class from all tabs
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Show selected tab content
      const selectedTab = document.getElementById(tabName + 'Tab');
      if (selectedTab) {
        selectedTab.classList.add('active');
      }
      
      // Add active class to clicked tab
      event.target.classList.add('active');
    };
  </script>
  <!-- Keep navbar separate to avoid conflicts -->
</body>
</html>
